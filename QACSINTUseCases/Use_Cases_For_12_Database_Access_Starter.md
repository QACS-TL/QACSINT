# Agile User Stories for Zoo Tycoon Animal Management System

## 12 Database Access â€“ Starter

### Database Backed Animal Storage Version

------------------------------------------------------------------------

## User Story 89: Database-Backed Animal Storage (EF Core Integration)

**As a** zoo administrator

**I want** animals to be stored in a SQL Server database

**So that** data persists between application runs

### Acceptance Criteria:

- ZooContext class created using Entity Framework Core

- DbSet\<Animal\> exposed for CRUD operations

- Program.LoadAnimals() retrieves animals from the database instead of
  hardcoded lists

- Program.AddAnimal(), EditAnimal(), RemoveAnimal() perform database
  writes

- EF Core discriminator configured for Dog, Cat, Bird inheritance

- Application runs without requiring manual SQL scripts

**Priority:** High

**Story Points:** 13

------------------------------------------------------------------------

## User Story 90: Replace Static Auto-Increment ID With Database Identity

**As a** developer

**I want** animal IDs to be generated by the database

**So that** ID management is consistent and avoids conflicts

### Acceptance Criteria:

- Animal.id static counter removed

- EF Core \[Key\] attribute used on Animal.Id

- Database auto-increments Id values

- Constructors accept optional id but default to 0 for EF Core

- Tests updated to reflect database-generated IDs

**Priority:** High

**Story Points:** 8

------------------------------------------------------------------------

## User Story 91: Introduce ZooContext With Table-Per-Hierarchy (TPH) Inheritance

**As a** developer

**I want** EF Core to correctly map Animal subclasses

**So that** Dog, Cat, and Bird objects persist with correct type
information

### Acceptance Criteria:

- ZooContext.OnModelCreating configures discriminator column
  "AnimalType"

- Dog, Cat, Bird mapped to discriminator values "Dog", "Cat", "Bird"

- Base Animal properties stored in shared table

- Subclass-specific fields stored in same table (TPH)

**Priority:** Medium

**Story Points:** 5

------------------------------------------------------------------------

## User Story 92: Update Program.MainMenu to Reload Animals from Database Each Loop

**As a** user

**I want** the UI to always show the latest animal data

**So that** changes made by add/edit/remove operations are immediately
visible

### Acceptance Criteria:

- MainMenu reloads animals via LoadAnimals() on each loop iteration

- No in-memory list persists between menu actions

- UI always reflects current DB state

**Priority:** Medium

**Story Points:** 3

------------------------------------------------------------------------

## User Story 93: Persist Animal Edits to Database

**As a** zoo administrator

**I want** edits to animal attributes to be saved permanently

**So that** changes are not lost when the program exits

### Acceptance Criteria:

- EditAnimal() updates the matching database record

- EF Core tracks and saves changes

- Only editable fields updated (Name, Colour, LimbCount, subclass
  fields)

- Validation rules still enforced

**Priority:** High

**Story Points:** 5

------------------------------------------------------------------------

## User Story 94: Persist Animal Deletions to Database

**As a** zoo administrator

**I want** removed animals to be deleted from the database

**So that** the system reflects the current zoo population

### Acceptance Criteria:

- RemoveAnimal() deletes the selected animal via EF Core

- Database SaveChanges() commits deletion

- UI confirms removal

**Priority:** Medium

**Story Points:** 3

------------------------------------------------------------------------

## User Story 95: Update AddAnimal to Save New Animals to Database

**As a** zoo administrator

**I want** new animals to be saved directly to the database

**So that** they persist across sessions

### Acceptance Criteria:

- AddAnimal() creates subclass instance

- EF Core Add() and SaveChanges() used

- New ID assigned by database

- UI does not rely on static ID counters

**Priority:** High

**Story Points:** 5

------------------------------------------------------------------------

## User Story 96: Remove SaveAnimals() and In-Memory Persistence Logic

**As a** developer

**I want** to eliminate obsolete file-based or in-memory save logic

**So that** the system uses a single persistence mechanism

### Acceptance Criteria:

- SaveAnimals() removed or commented out

- No in-memory list persists between operations

- All CRUD operations use EF Core

**Priority:** Medium

**Story Points:** 2

------------------------------------------------------------------------

## User Story 97: Modify Tests to Remove Dependency on Static ID Generation

**As a** developer

**I want** tests to work without relying on static ID counters

**So that** tests remain deterministic and independent of runtime state

### Acceptance Criteria:

- Tests no longer reset Animal.id

- Tests explicitly pass id values to constructors

- Tests updated to reflect EF Core identity behavior

- ProgramTests no longer test LoadAnimals() (DB-dependent)

**Priority:** High

**Story Points:** 8

------------------------------------------------------------------------

## User Story 98: Add Parameterless Constructor for EF Core Compatibility

**As a developer** I want EF Core to instantiate Animal and subclasses
So that database operations work correctly

### Acceptance Criteria:

- Animal class includes a parameterless constructor

- Subclasses continue to use existing constructors

- EF Core can materialize objects without errors

**Priority:** Medium **Story Points:** 3

------------------------------------------------------------------------

## User Story 99: Introduce DataAnnotations for EF Core Mapping

**As a** developer

**I want** to use DataAnnotations to define EF Core metadata

**So that** the database schema is generated correctly

### Acceptance Criteria:

- \[Key\] attribute added to Animal.Id

- Optional: future attributes (e.g., \[Required\], \[MaxLength\])
  supported

- EF Core migrations recognize model structure

**Priority:** Low

**Story Points:** 2

------------------------------------------------------------------------

## User Story 100: Ensure UI Logic Works With Database-Generated IDs

**As a** user

**I want** the UI to correctly display and use database IDs

**So that** selecting and editing animals works reliably

### Acceptance Criteria:

- ListAnimals() displays correct Id values

- EditAnimal() and RemoveAnimal() use Id to find DB record

- No assumptions about sequential IDs

**Priority:** Medium

**Story Points:** 5

------------------------------------------------------------------------

## Technical Notes (Major Changes & Impacts)

### Major Architectural Changes

- Migration from **in-memory list** to **full database persistence**
  using **Entity Framework Core**

- Introduction of **ZooContext** as the central data access layer

- Adoption of **Table-Per-Hierarchy (TPH)** inheritance mapping

- Removal of static ID generation logic

- Program flow updated to reload data from DB each loop iteration

------------------------------------------------------------------------

### New OOP Principles Demonstrated

- **Inheritance + Polymorphism** integrated with EF Core discriminator
  mapping

- **Encapsulation** preserved while enabling EF Core property mapping

- **Interface implementation** (ICloneable\<T\>) unchanged but now
  coexists with EF Core

- **Constructor overloading** expanded to support EF Core
  materialization

------------------------------------------------------------------------

### Testing Strategy Changes

- Tests no longer rely on static ID counters

- Tests avoid database dependency (LoadAnimals test removed)

- Tests now explicitly pass IDs to constructors

- Subclass tests updated to reflect new default ID behavior (0 when not
  provided)

------------------------------------------------------------------------

### Code Quality Improvements

- Centralized persistence logic (no more SaveAnimals duplication)

- Cleaner Program.cs with reduced commented-out legacy code

- More consistent object creation and validation

- EF Core ensures data integrity and reduces manual ID management

------------------------------------------------------------------------

### Migration Impacts

- Existing in-memory logic deprecated

- Database must be created and migrations applied before running

- Old tests relying on static IDs must be rewritten

- Developers must understand EF Core lifecycle (DbContext per operation)
